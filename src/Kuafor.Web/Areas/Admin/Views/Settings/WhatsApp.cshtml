@model Kuafor.Web.Areas.Admin.Controllers.WhatsAppSettingsViewModel
@{
    ViewData["Title"] = "WhatsApp Ayarları";
    Layout = "_Layout.Admin";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">WhatsApp Ayarları</h3>
                </div>
                <div class="card-body">
                    <form asp-action="WhatsApp" method="post">
                        <div class="row">
                            <!-- Widget Ayarları -->
                            <div class="col-md-6">
                                <h5>Widget Ayarları</h5>
                                <div class="mb-3">
                                    <label asp-for="PhoneNumber" class="form-label">WhatsApp Numarası</label>
                                    <input asp-for="PhoneNumber" class="form-control" placeholder="+905559998877">
                                    <div class="form-text">Widget'ta görünecek WhatsApp numarası</div>
                                </div>
                                <div class="mb-3">
                                    <label asp-for="CallToAction" class="form-label">Çağrı Metni</label>
                                    <input asp-for="CallToAction" class="form-control" placeholder="Nasıl yardımcı olabilirim?">
                                    <div class="form-text">Widget butonunda görünecek metin</div>
                                </div>
                                <div class="mb-3">
                                    <label asp-for="Position" class="form-label">Pozisyon</label>
                                    <select asp-for="Position" class="form-select">
                                        <option value="right">Sağ</option>
                                        <option value="left">Sol</option>
                                    </select>
                                    <div class="form-text">Widget'ın ekrandaki konumu</div>
                                </div>
                            </div>

                            <!-- API Ayarları -->
                            <div class="col-md-6">
                                <h5>API Ayarları</h5>
                                <div class="mb-3">
                                    <label asp-for="AccessToken" class="form-label">Access Token</label>
                                    <input asp-for="AccessToken" class="form-control" type="password">
                                    <div class="form-text">Meta WhatsApp Business API token</div>
                                </div>
                                <div class="mb-3">
                                    <label asp-for="PhoneNumberId" class="form-label">Phone Number ID</label>
                                    <input asp-for="PhoneNumberId" class="form-control">
                                    <div class="form-text">Meta WhatsApp Business Phone Number ID</div>
                                </div>
                                <div class="mb-3">
                                    <label asp-for="BusinessAccountId" class="form-label">Business Account ID</label>
                                    <input asp-for="BusinessAccountId" class="form-control">
                                    <div class="form-text">Meta WhatsApp Business Account ID</div>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Önemli:</strong> Bu ayarlar appsettings.json dosyasında manuel olarak güncellenmelidir. 
                                    Değişikliklerin etkili olması için uygulama yeniden başlatılmalıdır.
                                </div>
                            </div>
                        </div>

                        <div class="row mt-3">
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>Ayarları Kaydet
                                </button>
                                <a href="@Url.Action("Index", "Messaging")" class="btn btn-secondary">
                                    <i class="fab fa-whatsapp me-2"></i>Mesajlaşma Paneli
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Widget Önizleme -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="card-title">Widget Önizleme</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Widget önizlemesi için sayfa yeniden yüklenecektir.
                    </div>
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-outline-primary" onclick="previewWidget()">
                            <i class="fas fa-eye me-2"></i>Önizleme
                        </button>
                        <button type="button" class="btn btn-outline-success" onclick="testWidget()">
                            <i class="fab fa-whatsapp me-2"></i>Widget Test
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function previewWidget() {
    // Form verilerini al
    const phoneNumber = document.querySelector('input[name="PhoneNumber"]').value;
    const callToAction = document.querySelector('input[name="CallToAction"]').value;
    const position = document.querySelector('select[name="Position"]').value;
    
    // URL parametreleri ile önizleme sayfasına git
    const previewUrl = `/Customer?preview=true&phone=${encodeURIComponent(phoneNumber)}&action=${encodeURIComponent(callToAction)}&pos=${position}`;
    window.open(previewUrl, '_blank');
}

function testWidget() {
    const phoneNumber = document.querySelector('input[name="PhoneNumber"]').value;
    if (!phoneNumber) {
        alert('Lütfen WhatsApp numarasını girin');
        return;
    }
    
    // WhatsApp'ı test et
    const whatsappUrl = `https://wa.me/${phoneNumber.replace(/[^0-9]/g, '')}?text=Merhaba, test mesajıdır.`;
    window.open(whatsappUrl, '_blank');
}
</script>
