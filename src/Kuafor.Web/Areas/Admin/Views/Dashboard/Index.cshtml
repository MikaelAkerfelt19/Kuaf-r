@model Kuafor.Web.Models.Admin.AdminDashboardViewModel
@{
    ViewData["Title"] = "Geli≈ümi≈ü Pano";
}

<div class="d-flex align-items-center justify-content-between mb-4">
    <h2 class="mb-0">üìä Geli≈ümi≈ü Pano</h2>
    <div class="d-flex gap-2">
        <button class="btn btn-outline-primary btn-sm" onclick="refreshDashboard()">
            <i class="bi bi-arrow-clockwise"></i> Yenile
        </button>
        <div class="dropdown">
            <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                <i class="bi bi-calendar"></i> Son 30 G√ºn
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="changePeriod(7)">Son 7 G√ºn</a></li>
                <li><a class="dropdown-item" href="#" onclick="changePeriod(30)">Son 30 G√ºn</a></li>
                <li><a class="dropdown-item" href="#" onclick="changePeriod(90)">Son 90 G√ºn</a></li>
            </ul>
        </div>
    </div>
</div>

<!-- KPI Kartlarƒ± -->
<div class="row g-3 mb-4">
    @foreach (var kpi in Model.Kpis)
    {
        <div class="col-6 col-md-3">
            <div class="card border-0 shadow-sm h-100 kpi-card" data-color="@kpi.Color">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between mb-2">
                        <div class="kpi-icon">
                            <i class="@kpi.Icon text-@kpi.Color"></i>
                        </div>
                        @if (!string.IsNullOrEmpty(kpi.Badge))
                        {
                            <span class="badge bg-@(kpi.Badge.StartsWith("+") ? "success" : "danger")">@kpi.Badge</span>
                        }
                    </div>
                    <div class="text-muted small">@kpi.Label</div>
                    <div class="fs-4 fw-bold text-@kpi.Color">@kpi.Value</div>
                    <div class="text-muted small">@kpi.SubText</div>
                </div>
            </div>
        </div>
    }
</div>

<!-- Trend Analizi -->
<div class="row g-3 mb-4">
    <div class="col-md-4">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <h6 class="mb-0">Ciro Trendi</h6>
                    <i class="@Model.RevenueTrend.TrendIcon text-@(Model.RevenueTrend.Trend == "up" ? "success" : Model.RevenueTrend.Trend == "down" ? "danger" : "secondary")"></i>
                </div>
                <div class="fs-5 fw-bold">‚Ç∫@Model.RevenueTrend.CurrentValue.ToString("N0")</div>
                <div class="text-muted small">
                    @Model.RevenueTrend.ChangePercentage.ToString("+0.0;-0.0;0")% 
                    <span class="text-@(Model.RevenueTrend.Trend == "up" ? "success" : Model.RevenueTrend.Trend == "down" ? "danger" : "secondary")">
                        (@Model.RevenueTrend.Trend)
                    </span>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <h6 class="mb-0">Randevu Trendi</h6>
                    <i class="@Model.AppointmentTrend.TrendIcon text-@(Model.AppointmentTrend.Trend == "up" ? "success" : Model.AppointmentTrend.Trend == "down" ? "danger" : "secondary")"></i>
                </div>
                <div class="fs-5 fw-bold">@Model.AppointmentTrend.CurrentValue.ToString("N0")</div>
                <div class="text-muted small">
                    @Model.AppointmentTrend.ChangePercentage.ToString("+0.0;-0.0;0")% 
                    <span class="text-@(Model.AppointmentTrend.Trend == "up" ? "success" : Model.AppointmentTrend.Trend == "down" ? "danger" : "secondary")">
                        (@Model.AppointmentTrend.Trend)
                    </span>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <h6 class="mb-0">M√º≈üteri Trendi</h6>
                    <i class="@Model.CustomerTrend.TrendIcon text-@(Model.CustomerTrend.Trend == "up" ? "success" : Model.CustomerTrend.Trend == "down" ? "danger" : "secondary")"></i>
                </div>
                <div class="fs-5 fw-bold">@Model.CustomerTrend.CurrentValue.ToString("N0")</div>
                <div class="text-muted small">
                    @Model.CustomerTrend.ChangePercentage.ToString("+0.0;-0.0;0")% 
                    <span class="text-@(Model.CustomerTrend.Trend == "up" ? "success" : Model.CustomerTrend.Trend == "down" ? "danger" : "secondary")">
                        (@Model.CustomerTrend.Trend)
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Grafikler -->
<div class="row g-3 mb-4">
    <div class="col-lg-8">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0">
                <div class="d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">Ciro ve Randevu Grafiƒüi</h6>
                    <div class="btn-group btn-group-sm" role="group">
                        <button type="button" class="btn btn-outline-primary active" onclick="showChart('revenue')">Ciro</button>
                        <button type="button" class="btn btn-outline-primary" onclick="showChart('appointments')">Randevular</button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <canvas id="mainChart" height="300"></canvas>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-0">
                <h6 class="mb-0">M√º≈üteri Segmentasyonu</h6>
            </div>
            <div class="card-body">
                <canvas id="customerSegmentChart" height="250"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Ana ƒ∞√ßerik -->
<div class="row g-3 mb-4">
    <!-- Bug√ºn√ºn Randevularƒ± -->
    <div class="col-lg-7">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0">
                <div class="d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">Bug√ºn√ºn Randevularƒ±</h6>
                    <a class="btn btn-sm btn-outline-primary" asp-area="Admin" asp-controller="Appointments" asp-action="Index">
                        T√ºm√º <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Saat</th>
                                <th>M√º≈üteri</th>
                                <th>Hizmet</th>
                                <th>Kuaf√∂r</th>
                                <th>Durum</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var appointment in Model.Upcoming)
                            {
                                <tr>
                                    <td>
                                        <div class="fw-semibold">@appointment.When.ToString("HH:mm")</div>
                                        <small class="text-muted">@appointment.When.ToString("dd/MM")</small>
                                    </td>
                                    <td>
                                        <div class="fw-semibold">@appointment.Customer</div>
                                        <small class="text-muted">@appointment.Branch</small>
                                    </td>
                                    <td>@appointment.Service</td>
                                    <td>@appointment.Stylist</td>
                                    <td>
                                        <span class="badge bg-success">Aktif</span>
                                    </td>
                                    <td class="text-end">
                                        <a class="btn btn-sm btn-outline-primary" asp-area="Admin" asp-controller="Appointments" asp-action="Details" asp-route-id="@appointment.Id">
                                            <i class="bi bi-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- En √áok Tercih Edilen Hizmetler -->
    <div class="col-lg-5">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-0">
                <h6 class="mb-0">En √áok Tercih Edilen Hizmetler</h6>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    @foreach (var service in Model.TopServices)
                    {
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                            <div>
                                <div class="fw-semibold">@service.Service</div>
                                <small class="text-muted">Son 7 g√ºn</small>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-primary rounded-pill fs-6">@service.Count</span>
                                <div class="text-success small">@service.Trend</div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Performans Kartlarƒ± -->
<div class="row g-3 mb-4">
    <!-- En ƒ∞yi Kuaf√∂rler -->
    <div class="col-lg-6">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0">
                <h6 class="mb-0">En ƒ∞yi Performans G√∂steren Kuaf√∂rler</h6>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm mb-0">
                        <thead>
                            <tr>
                                <th>Kuaf√∂r</th>
                                <th>Randevu</th>
                                <th>Ciro</th>
                                <th>Puan</th>
                                <th>Trend</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var stylist in Model.TopStylists)
                            {
                                <tr>
                                    <td class="fw-semibold">@stylist.Name</td>
                                    <td>@stylist.AppointmentCount</td>
                                    <td>‚Ç∫@stylist.Revenue.ToString("N0")</td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <span class="me-1">@stylist.Rating.ToString("F1")</span>
                                            <i class="bi bi-star-fill text-warning"></i>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-success">@stylist.Trend</span>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ≈ûube Performanslarƒ± -->
    <div class="col-lg-6">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0">
                <h6 class="mb-0">≈ûube Performanslarƒ±</h6>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm mb-0">
                        <thead>
                            <tr>
                                <th>≈ûube</th>
                                <th>Randevu</th>
                                <th>Ciro</th>
                                <th>Kuaf√∂r</th>
                                <th>Kullanƒ±m</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var branch in Model.BranchPerformances)
                            {
                                <tr>
                                    <td class="fw-semibold">@branch.Name</td>
                                    <td>@branch.AppointmentCount</td>
                                    <td>‚Ç∫@branch.Revenue.ToString("N0")</td>
                                    <td>@branch.ActiveStylists</td>
                                    <td>
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar" style="width: @branch.UtilizationRate%"></div>
                                        </div>
                                        <small class="text-muted">@branch.UtilizationRate.ToString("F1")%</small>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Alt Kartlar -->
<div class="row g-3">
    <!-- Son Aktiviteler -->
    <div class="col-lg-6">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0">
                <h6 class="mb-0">Son Aktiviteler</h6>
            </div>
            <div class="card-body">
                <div class="timeline">
                    @foreach (var activity in Model.RecentActivities)
                    {
                        <div class="timeline-item">
                            <div class="timeline-marker bg-@activity.Color"></div>
                            <div class="timeline-content">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <div class="fw-semibold">@activity.Type</div>
                                        <div class="text-muted small">@activity.Description</div>
                                    </div>
                                    <small class="text-muted">@activity.Timestamp.ToString("HH:mm")</small>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Stok Uyarƒ±larƒ± -->
    <div class="col-lg-6">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0">
                <h6 class="mb-0">Stok Uyarƒ±larƒ±</h6>
            </div>
            <div class="card-body">
                @if (Model.InventoryAlerts.Any())
                {
                    <div class="list-group list-group-flush">
                        @foreach (var alert in Model.InventoryAlerts)
                        {
                            <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <div>
                                    <div class="fw-semibold">@alert.ProductName</div>
                                    <small class="text-muted">Mevcut: @alert.CurrentStock, Min: @alert.MinimumStock</small>
                                </div>
                                <span class="badge bg-@alert.AlertLevel">
                                    @(alert.AlertLevel == "danger" ? "Kritik" : alert.AlertLevel == "warning" ? "Dikkat" : "Bilgi")
                                </span>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div class="text-center text-muted py-3">
                        <i class="bi bi-check-circle-fill text-success fs-1"></i>
                        <div class="mt-2">T√ºm √ºr√ºnler stokta yeterli</div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="~/js/advanced-dashboard.js"></script>
    <script>
        // Dashboard verilerini JavaScript'e aktar
        window.dashboardData = {
            revenueChart: @Html.Raw(Json.Serialize(Model.RevenueChart)),
            appointmentChart: @Html.Raw(Json.Serialize(Model.AppointmentChart)),
            customerSegments: @Html.Raw(Json.Serialize(Model.CustomerSegments))
        };
    </script>
}
