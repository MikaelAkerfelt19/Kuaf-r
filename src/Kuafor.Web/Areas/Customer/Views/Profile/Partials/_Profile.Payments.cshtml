@model Kuafor.Web.Models.Profile.PaymentsViewModel
@using System.Globalization

<div class="card border-0 shadow-sm">
    <div class="card-body">
        <h5 class="card-title mb-3">Ödeme Yöntemleri</h5>

        <!-- Kayıtlı Kartlar -->
        <div class="d-flex justify-content-between align-items-center">
            <h6 class="mb-2">Kayıtlı Kartlar</h6>
            <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#cardModal"
                onclick="window.payCardNew()">Kart Ekle</button>
        </div>

        @if (Model.Cards.Count == 0)
        {
            <div class="alert alert-light border">Kayıtlı kartın yok.</div>
        }
        else
        {
            <div class="row g-3">
                @foreach (var c in Model.Cards)
                {
                    <div class="col-12 col-md-6 col-lg-4">
                        <div class="border rounded p-3 h-100 d-flex flex-column">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="fw-semibold">@c.Mask</div>
                                    <div class="text-muted small">@c.HolderName · @c.ExpMonth/@c.ExpYear</div>
                                </div>
                                @if (c.IsDefault)
                                {
                                    <span class="badge bg-success">Varsayılan</span>
                                }
                            </div>

                            <div class="mt-auto d-flex gap-2">
                                @if (!c.IsDefault)
                                {
                                    <button class="btn btn-sm btn-outline-primary"
                                        onclick="window.payCardMakeDefault(@c.Id)">Varsayılan Yap</button>
                                }
                                <button class="btn btn-sm btn-outline-danger" onclick="window.payCardDelete(@c.Id)">Sil</button>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }

        <hr class="my-4" />

        <!-- Fatura Bilgileri -->
        <h6 class="mb-3">Fatura Bilgileri</h6>
        <div class="row g-3">
            <div class="col-md-4">
                <label class="form-label">Tip</label>
                <select id="invType" class="form-select">
                    @if (Model.Billing.InvoiceType == "Bireysel")
                    {
                        <option value="Bireysel" selected>Bireysel</option>
                        <option value="Sirket">Şirket</option>
                    }
                    else if (Model.Billing.InvoiceType == "Sirket")
                    {
                        <option value="Bireysel">Bireysel</option>
                        <option value="Sirket" selected>Şirket</option>
                    }
                </select>
            </div>
            <div class="col-md-8">
                <label class="form-label">Ad Soyad / Ünvan</label>
                <input id="invName" class="form-control" value="@Model.Billing.FullNameOrCompany" />
            </div>
            <div class="col-md-6">
                <label class="form-label">VKN / TCKN</label>
                <input id="invTax" class="form-control" value="@Model.Billing.TaxNumber"
                    placeholder="Bireysel için TCKN, şirket için VKN" />
            </div>
            <div class="col-md-6">
                <label class="form-label">E-posta (e-Fatura gönderimi)</label>
                <input id="invEmail" type="email" class="form-control" value="@Model.Billing.Email" />
            </div>
            <div class="col-12">
                <label class="form-label">Adres</label>
                <input id="invAddr" class="form-control" value="@Model.Billing.AddressLine1" />
            </div>
            <div class="col-md-4">
                <label class="form-label">İlçe</label>
                <input id="invDistrict" class="form-control" value="@Model.Billing.District" />
            </div>
            <div class="col-md-4">
                <label class="form-label">Şehir</label>
                <input id="invCity" class="form-control" value="@Model.Billing.City" />
            </div>
            <div class="col-md-4">
                <label class="form-label">Posta Kodu</label>
                <input id="invZip" class="form-control" value="@Model.Billing.Zip" />
            </div>
            <div class="col-12 form-check">
                <input id="invEinv" type="checkbox" class="form-check-input" @(Model.Billing.EInvoiceOptIn ? "checked" : null) />
                <label class="form-check-label" for="invEinv">e-Fatura tercihi</label>
            </div>
            <div class="col-12">
                <button class="btn btn-primary" type="button" onclick="window.payBillingSave()">Kaydet</button>
            </div>
        </div>
    </div>
</div>

<!-- Kart Ekle Modal (mock) -->
<div class="modal fade" id="cardModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="cardModalLabel">Kart Ekle</h5>
                <button class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
            </div>
            <div class="modal-body">
                <div class="row g-3">
                    <div class="col-12">
                        <label class="form-label">Kart Sahibi</label>
                        <input id="cardHolder" class="form-control" placeholder="AD SOYAD" />
                    </div>
                    <div class="col-12">
                        <label class="form-label">Kart Numarası</label>
                        <input id="cardNumber" class="form-control" inputmode="numeric" maxlength="19"
                            placeholder="**** **** **** ****" />
                    </div>
                    <div class="col-6">
                        <label class="form-label">Ay</label>
                        <input id="cardExpM" type="number" min="1" max="12" class="form-control" placeholder="MM" />
                    </div>
                    <div class="col-6">
                        <label class="form-label">Yıl</label>
                        <input id="cardExpY" type="number" min="2025" max="2035" class="form-control"
                            placeholder="YYYY" />
                    </div>
                    <div class="col-6">
                        <label class="form-label">CVC</label>
                        <input id="cardCvc" type="password" maxlength="4" class="form-control" placeholder="CVC" />
                    </div>
                    <div class="col-6 form-check d-flex align-items-end">
                        <input id="cardDefault" type="checkbox" class="form-check-input me-2" />
                        <label class="form-check-label" for="cardDefault">Varsayılan yap</label>
                    </div>
                </div>
                <div class="text-muted small mt-2">Not: Bu ekran yalnızca UI mock’tur; gerçek kart verisi saklanmaz.
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Kapat</button>
                <button class="btn btn-primary" type="button" onclick="window.payCardSave()">Kaydet</button>
            </div>
        </div>
    </div>
</div>
